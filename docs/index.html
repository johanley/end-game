<!DOCTYPE html>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta name="keywords" content="retirement, Canada, Canadian, simulator, calculator, planner">
 <meta name="description" content="Personal finance simulator for retired Canadians.">
 <meta name="viewport" content="width=device-width"> 
 <link rel="stylesheet" type="text/css" href="stylesheet.css?v=1" media="all"> 
 <title>End Game: Personal finance simulator for retired Canadians</title>
</head>

<body>

<h2>End Game - personal finance simulator for retired Canadians</h2>

<P>The source code is <a href='https://github.com/johanley/end-game'>here</a>.

<ul>
 <li><a href="#overview">Overview</a>
 <li><a href="#limitations">Limitations</a>
 <li><a href="#features">Features</a>
 <li><a href="#scenarios">Example Scenarios</a>
 <li><a href="#lessons">Lessons Learned</a>
 <li><a href="#running">Running The Code In Eclipse</a>
 <li><a href="#syntax">Syntax of the Scenario File</a>
 <li><a href="#examplesnippets">Example Snippets for the Scenario File</a>
</ul> 

<h2 id='overview'>Overview</h2>
The main purpose of this project is: 
<ul> 
 <li>to help you explore different retirement scenarios  
 <li>to help you find a better financial plan for your retirement
</ul>

<P><b>This tool is focused almost entirely on the retirement phase of life (spending), not on the 
working phase of life (saving)</b>.

<P>The level of detail in this tool is higher than usual.
Whereas most tools focus on a high-level rate of return, this tool actually goes through every single day of your retirement, 
and applies transactions to your accounts.
It also calculates a basic tax return at the end of every year.

<P>The level of detail will not reflect your actual reality 100%, but it will get you closer to reality than most other tools.
It's a trade off: in a perfect world, matching reality 100% is of course desirable; but to implement all possible cases
for all possible conditions is not practical here. 
So this tool tries to reach a compromise, and <b>tries to reflect reality to a reasonable degree, but not with 100% accuracy</b>. 

<P>
Every retirement financial plan should be supported by a robust simulation showing you the numbers.
Personal finance is quite complex.
There are many moving parts, and how those parts all work together in your particular case can be found only with a simulator. 
<b>You can't do these calculations in your head, and you shouldn't rely entirely on <em>rules of thumb</em>, because such 
rules usually have exceptions.</b>

<P>This tool has:
<ul>
 <li>helped me find thousands of additional dollars in cash flow
 <li>increased my level of confidence in my financial plan
 <li>helped me answer many different questions
 <li>helped me in speaking to a financial advisor
</ul>

<h2 id='limitations'>Limitations</h2>
This tool has a limited scope:
<ul>
 <li>there's no spousal logic.
 <li>the set of supported securities is only cash, stocks, and GICs. 
 <li>it supports RSP/RIF, TFSA, non-registered accounts, and simple bank accounts, but no other types of accounts. 
 <li>there's no logic specific to insurance, debt, real estate, charitable donations, and so on.
</ul>

In spite of these limitations, you may find it useful to examine the example scenario outputs.

<P>There are <b>two important issues which I hope to address soon</b>:
<ul>
  <li>add support for ETFs (Exchange-traded funds, an asset class that is very widely held)
  <li>add support for LIRA/LIF accounts
 </ul>

In general, I would like to improve the tool. I could use some assistance with that.

<h2 id='features'>Features</h2>
Features include:
<ul>
 <li>input-output using text files
 <li>the input text file is a <em>scenario</em>, a text file describing details of your accounts, assets, transactions, 
  start-date for retirement, expected CPP benefit, pension, and so on
 <li>internally, the system runs through every single day of your entire retirement life, and applies transactions defined 
 in your scenario file
 <li>some scenarios have randomness, and some don't 
 <li>the randomness only comes from variation in the market price of securities
 <li>basic tax returns are calculated, both federal and provincial (territories not included at present)
 <li>the output is in .csv (comma-separated) files, which are easily imported into spreadsheet tools
 such as Google Sheets or Open Office (and thereby charted)
 <li>log output shows transactions, yearly summaries, and tax returns
 <li>you can repeat a scenario multiple times, to reflect the spread in outcomes caused by randomness (Monte Carlo simulation)
 <li>the tool can run multiple scenarios in sequence 
 <li>the code is implemented in Java, and can be run on any computer
 <li>changes to the market prices of stock are applied once a year
</ul>

<P>Some items that aren't modeled explicitly can still be effectively modeled by the system. 
 For example, the sale of a primary residence can be modeled as a simple windfall deposited to your bank account, since 
 no tax is paid on the capital gain when you sell your home.  

<P>There are two distinct types of scenarios:
<ul> 
 <li>those with precisely predictable cash flows (OAS, CPP, GIS, annuities, pensions)
 <li>those without precisely predictable cash flows (assets vary in value with the market price)
</ul>

<P>Examples of approximations made by the tool:
<ul> 
 <li>stock prices are updated just once a year (using a policy you define) 
 <li>the tax return is calculated and applied simply at the end of the year, and not later in the following year
 <li>OAS clawbacks are applied (for high income earners) all in one year; in reality, the clawback is applied over 2 calendar years
 <li>the life-table stats from Statistics Canada are for the Canada-wide case, not for the specific province
</ul>

<h2 id='scenarios'>Example Scenarios</h2>
These example scenarios are included in the source code. 
They are listed in rough order of increasing complexity.

<P>Note that the <em>.ini</em> file is the scenario file, and the remaining files in the directory are outputs that 
result from executing the scenario. The provincial tax return is for PE, Prince Edward Island, simply because 
that's where the author resides. The tool allows for all other provinces as well.

<table class='report'>
 <tr><th>ID<th>Description
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/01.1'>01.1</a><td>Never worked, no savings, retires at 65. OAS/GIS, rent 700. PE. Deterministic.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/01.2'>01.2</a><td>Worker with no savings, retires at 65. CPP 300/month, OAS/GIS. PE. Deterministic.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/01.3'>01.3</a><td>Worker with no savings, retires at 65. Average CPP 673/month, OAS/GIS, PE. Deterministic.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/01.4'>01.4</a><td> Worker with no savings, retires at 65. CPP max monthly 1175.75, OAS/GIS. PE. Deterministic.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/02.1'>02.1</a><td>Only a TFSA with 50k in blue-chip dividends. Half the average CPP. 3% dividend growth, 3% stock price growth.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/02.2'>02.2</a><td>Only a TFSA with 100k in blue-chip dividends. Half the average CPP. 3% dividend growth, 3% stock price growth.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/02.3'>02.3</a><td>Only a RIF with 100k in blue-chip dividends. Half the average CPP. 3% dividend growth, 3% stock price growth.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/02.4'>02.4</a><td>Only a NRA with 100k in blue-chip dividends. Half the average CPP. 3% dividend growth, 3% stock price growth.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/03.1'>03.1</a><td>Dividends only, never sell stocks. 3% dividend growth, 3% stock price growth.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/07.1'>07.1</a><td>Pension 2000 monthly, no other savings, house unsold, retires at 65. Average CPP 673/month, OAS/GIS. PE. Deterministic.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/07.2'>07.2</a><td>Govt of Canada pension 2234.00/month, no other savings, house unsold, retires at 65. Average CPP 673/month, OAS/GIS. PE. Deterministic.
 <tr><td><a href='https://github.com/johanley/end-game/tree/master/scenario/07.3'>07.3</a><td>GOC large pension 5483/month, no other savings, house unsold, retires at 65. Average CPP 673/month, OAS/GIS. PE. Deterministic.
</table>

<h2 id='lessons'>Lessons Learned</h2>

<b>Those with no savings will have cash flow in the low 20s.</b>
The cash flow for those who have no savings is basically the same no matter what your past history: it's in the low 20s.
This is because of how GIS works. GIS is designed to support cash flow up to a certain level, but not beyond that level.
Someone who has made 30K a year for their entire life, and has no savings, will have cash flow in the low 20s when 
they retire at 65, from OAS, GIS, and CPP. The same can be said if you made 100K a year, but spent it all and have no savings when 
you are 65. 

<P><b>It's the net cash flow that's most important.</b> That's where the focus should be. 
An example I saw had two scenarios, A vs B: A had 14k less tax than B, but only 2.9k more net cash than B.
If you leave out the net cash, and only focus on the tax saving, then you aren't fully informed.

<P><b>Spending generally decreases significantly in old age.</b>
Many people think in terms of having a flat cash flow, the same from retirement until death.
But, in reality, that's not usually what happens. 
It's a challenge to generate a cash flow curve that starts out higher and ends up lower, 
because the natural tendency for cash flow is to grow over time.
For those on a government pension (with no other savings), the cash flow is basically flat over time, and there's not much you 
can do about it.

<P><b>Many people die too rich</b>.
The psychology of the saver is different from the psychology of the spender.
Some spend many years as a saver, and later fail to change into a spender.
They keep growing their net worth until the end.
That isn't necessarily the wrong thing to do, but for many it's likely not the best outcome.
Oversaving can be as bad as overspending; perhaps it's best to avoid extremes.

<P><b>Living only off of dividends is almost always an error.</b>
Some investors are enthusiastic about dividend stocks, and attempt to generate cash flow only from the dividends, 
without selling any of the principal invested in the stocks.
During retirement, there's no need to be so conservative.
Periodically selling a small portion of your principal can generate a lot more cash flow, 
and is almost always better than relying solely on the dividends.   

<P><b>Selling stocks when the market is up, as opposed to when you want the cash, or a fixed schedule, is very beneficial.</b>
Given the large possible swings in stock prices, it makes sense to do <em>profit-taking</em> when the price is up.
You then save the cash for you future needs in 1-2 years (perhaps by purchasing a GIC).
You should avoid being compelled to sell stocks at a particular time.
The typical recession lasts about 1.5 years. 

<P><b>Desiring a sizeable legacy changes your plan significantly.</b> 
You have to understand what your goal is for your estate.
Some want to leave a significant legacy, and others want to spend as much as they can.
Both points of view are valid. 
But you have to know which is best for you, and act accordingly.

<P><b>Retirement planning is different from other projects, because it involves your own death.</b>
It's useful to be reminded that you might, by chance, die sooner rather than later.
The basic statistic from Statcan in this regard is interesting: the idea is that you start with a cohort of 
100,000 people at birth, and you then simply list the number of people that are still alive at each year of age.
The output spreadsheet files of this project usually incorporate this stat as a reminder of its importance.

 
<h2 id='running'>Running The Code In Eclipse</h2>

To run the code, this project recommends the <em>Eclipse</em> tool, a  
tool that programmers use to run and edit code. 
Here, you just want to run the code, not change it.

<P>Here are the <a href='gettingstarted/index.html'>detailed instructions</a>. It takes 10-15 minutes to get set up.


<h2 id='syntax'>Syntax of the Scenario File</h2>
The scenario file has a specific syntax.
That is, the text in the scenario file has to <em>make sense</em> to the code.
You have to follow those rules, or an error will result, and the code will stop executing.

<P>It's usually best to start with an example scenario file that is closest to your situation.

<P>Note that a leading # character means that text is a comment.

<h3 id='whencontrol'>The <em>on</em> statement</h3>

<P>There's a special <em>on</em> syntax for controlling when transactions are applied, and it occurs in various places.
Examples:

<pre>bank-debit-credit 925.00 on *-01</pre>
This means your bank is debited 925.00 on the first of every single month. 
 
<pre>on *-11-25</pre>
This means on every November 25th.

<pre>on *-11-25</pre>
This means on every November 25th. 

<pre>on *-03-01,*-06-01,*-09-01,*-12-01</pre>
This means on every March 1, June 1, September 1, and December 1 (quarterly dividend payments).

<pre>sell 6.0% on *-11-26 | 2027-01-01..2034-12-31</pre>
Executed every November 26, in the years 2027 to 2034. When the "|" appears, it adds start-date, end-date, or both.
There are 3 variations 
<pre>
sell 6.0% on *-11-26 | 2027-01-01..2034-12-31  # start-date and end-date
sell 6.0% on *-11-26 | 2027-01-01..            # only start-date
sell 6.0% on *-11-26 | ..2034-12-31            # only end-date</pre>
An exception to the above is the purchase of a GIC, which always uses a specific date.
In this case, the ":" character is used: 
<pre>buy-gic rif "Cda Trust" 5700.00 2.5% 1-year : 2024-06-21</pre>



<h2 id='examplesnippets'>Example Snippets for the Scenario File</h2>

<p><pre>syntax-version = v1.0.0</pre>
States that this scenario file was created with a given version of the syntax for scenario files (which may change over time).
The idea is to ensure that code processing a scenario file knows the exact syntax of the file it's supposed to process.
The code is not smart enough to be backwards-compatible with "old" versions of the syntax.

<P><pre>description = "101.6: Fixed 3% growth in stock prices..."</pre>
A free-form, high-level description of important aspects of the scenario. 

<P><pre>number-of-iterations = 1</pre>
Usually 1. You change it to more than 1 when you want to repeat the scenario, from start to finish, multiple times.
This only makes sense if the various iterations have different results.
For example, when stock prices are generated using randomness, running multiple iterations makes logical sense, to see the general spread in the resulting outputs.
When greater than 1, the generated .csv files are completely different.

<P><pre>update-stock-prices {
  on *-11-25 # when stock prices are to be updated
  # gaussian mean = 5.0%  std-dev = 5.0% 
  # range = -5%_10%
  fixed = 3% # no randomness here
  # explicit-list = 5%,5%,5%,5%,5%,-7% # in order of year; recycles if end is reached
}</pre>
Controls how stock prices change over time.
In this example, the prices are updated only on November 25 of each year.
The <em>gaussian</em> style means that price increases follow a <a href='https://en.wikipedia.org/wiki/Normal_distribution'>Gaussian distribution</a>.
The <em>range</em> example above means that the percentage price increase is randomly selected between -5% and +10%.

<P><pre>simulation-start-date = 2022-01-01
simulation-end-date = 2042-12-31</pre>
The start and end dates for running the simulation. 
If multiple iterations are run, then each iteration starts with the start date.
Optionally, there can also be a test to see if the person has died at the end of the year.
If that is activated, then the simulation will often terminate before the end date is reached. 
(See below.)


<P><pre>date-of-birth = 1962-03-01
annual-test-for-survival
sex = male</pre>
The person's date of birth is used for various calculations.
If <em>annual-test-for-survival</em> is included, then at the end of each simulated year, a statistical 
test is performed by the system, to see if the person will survive into the next year. 
If they fail to survive the test, then they die, and the simulation/iteration is terminated.
This feature uses <a href='https://www150.statcan.gc.ca/n1/pub/84-537-x/84-537-x2021001-eng.htm'>life-tables from Statistics Canada</a>, and those tables are different between males and females.  
 
<p><pre>year-zero-amounts {
  net-income-before-adjustments = 15180.00  # line 23400
  net-income = 15180.00 # line 23600
  oas-income = 0.00
  employment-income = 0.00  
}</pre>
The simulation starts in the middle of life, and some items in the tax return need to refer to the previous year.
For the first year in the simulation, there is no data for the previous year, so this data fills that gap. 

<P><pre>oas {
  monthly-amount-at-65 = 648.67 # as of 2022-06
  # payments are actually first received on the month AFTER the start-month 
  start-month = 2027-03 # the month I turn 65
  payment-day = 28 # day of the month; never more than 28, otherwise you'll have no payment in February!
  clawback-threshold = 81761.00 # as of 2022; versus line 23400 of last year's tax return
  clawback-percent = 15%
  monthly-reward = 0.7% # for every month oas is delayed past 65
  boost-age = 75 # the age at which OAS is boosted by 10%
  boost-percent = 10%
  start-window-begin = 65 
  start-window-end = 70
  gis-employment-exemption = 5000.00
}</pre>
The data used to calculate the OAS (Old Age Security) benefit.
The <em>start-month</em> is especially important.

<P><pre>cpp { 
  # can be used for QPP as well, since they have nearly the same core logic
  nominal-monthly-amount = 857.00 # if you start at age 65
  start-month = 2022-03           # the month I choose to start cpp payments
  payment-day = 28   # not more than 28, otherwise you'll have no payment in most months of February!
  # payments are actually first received on the month AFTER the start-month
  monthly-reward = 0.7%   # for every month cpp is delayed past age 65
  monthly-penalty = 0.6%  # for every month cpp is started before age 65
  start-window-begin = 60 
  start-nominal = 65
  start-window-end = 70
}</pre>
The data used to calculate your CPP benefit.
The <em>nominal-monthly-amount</em> and the <em>start-month</em> are especially important.

<P><pre>rif-minimum-withdrawals {
 # Applied to the market value of the RIF at the start of each year.
 # The left-hand side is your age on Jan 1. For ages outside this range, a formula applies
 # Ref: https://www.budget.gc.ca/2015/docs/plan/anx5-1-eng.html
 71 = 5.28%
 72 = 5.40%
 ...
 93 = 16.34%
 94 = 18.79%
}</pre>
RIF accounts always have a minimum annual withdrawal.
For some ages, a formula applies; for others, this table is used.

<P><pre>federal-tax {
  # Tax return settings.
  # These numbers are for 2021. Update them each year.
  initial-year = 2022 # must agree with simulation-start-date! 
  personal-amount = 12241.00  # Worksheet for line 30000
  personal-amount-additional = 1387.00
  personal-amount-threshold = 151978.00_216511.00
  age-amount = 7713.00 # Worksheet line 30100
  age-amount-threshold = 38893.00
  pension-income-max = 2000.00 # line 31400
  tax-brackets {
    15.00% : 49020.00    
    20.50% : 98040.00    
    26.00% : 151978.00   
    29.00% : 216511.00   
    33.00% : 100000000.00
  }
  rif-withholding-tax-brackets {
    # these amounts are above the rif's minimum withdrawal for that year
    10.00% : 5000.00    
    20.00% : 15000.00    
    30.00% : 100000000.00
  }
  standard-retirement-age = 65
  taxable-capital-gain-fraction = 0.5D
  dividend-tax-credit-numer = 6 
  dividend-tax-credit-denom = 11 
}</pre>
The federal part of a tax return. 
The numbers need to be updated yearly.
The <em>initial-year</em> must agree with the <em>start-date</em> entered above, near the start of the scenario file.

<P><pre>provincial-tax {
  # Usually there are significant differences between jurisdictions!
  # Each jurisdiction has its own set of fields.
  # Ref: https://www.canada.ca/en/revenue-agency/services/forms-publications/tax-packages-years/general-income-tax-benefit-package.html
  # Numbers from 2021 
  jurisdiction = PE 
  tax-brackets {
    9.8% : 31984.00    
    13.8% : 63969.00    
    16.7% : 100000000.00
  }
  personal-amount = 10500.00 # line 58040
  age-amount = 3764.00 # line 58080
  age-amount-threshold = 28019.00
  pension-income-max = 1000.00 # line 58360
  dividend-gross-up-mult = 10.5% # line 61520 worksheet
  low-income-basic = 350.00 # line 63370 
  low-income-age = 250.00 # line 63380
  low-income-threshold = 19000.00 # line 85
  low-income-rate = 5.00%
}</pre>
An example of a provincial tax return (for PEI).
The numbers have to be reviewed each year. 
See the <a href='https://github.com/johanley/end-game/tree/master/input/provincial-tax'>input\provincial-tax</a> directory for snippets appropriate to each province.

<P><pre>stocks {
  # Initial data on stocks; not related to an account.
  # All stocks must be defined here, even those you don't initially own.
  "ABC" {   
    price = 56.00
    dividend {
      on *-03-01,*-06-01,*-09-01,*-12-01
      amount = 0.86
      growth = 4.0%
    }
  }
  "XYZ" {
    price = 140.00
    dividend {
     on *-01-28,*-04-28,*-07-28,*-10-28
     amount = 1.61
     growth = 4.0%
    }
  }
}</pre>
Data for all stocks that will be part of the simulation.
The ticker symbol is used to identify the stock.
The annual growth in the dividend is always modeled here simply as a fixed percentage.
In the above examples, the dividends pay quarterly, on the given month-day combinations.

<p><pre>
stock-commission = fixed-percent 1.0%     # percent of the gross amount 
# stock-commission = fixed-amount 10.50   # some discount brokers have a flat rate
# stock-commission = custom-schedule      # requires custom coding</pre>
How to calculate the commission paid to your investment dealer when trading stocks.
The <em>custom-schedule</em> is to let you reflect you investment dealer's actual commission schedule.
It requires that you do some coding, by implementing the <a href='https://github.com/johanley/end-game/blob/master/src/endgame/security/stock/commission/CustomCommish.java'>CustomCommish</a> class.

<p><pre>tfsa-room {
  initial-room = 19877.98  
  yearly-limit = 6000.00
}</pre>
Used to calculate the room in your TFSA account (if you have one).
The <em>initial-room</em> is your TFSA room as of the <em>start-date</em> of the simulation.

<p><pre>accounts { 
  # Initial account holdings.
  # In this simulation, you can have only up to 1 account of each account-type.
  # Only the bank account is required. The others are optional.
  bank {
    cash = 10000.00
    small-balance-limit = 4000.00
  }
  rif {
    convert-rsp-to-rif = 2018-05-01
    cash = 0.00
    stock-positions {
      1910 "ABC"
      813 "XYZ"
      952 "XEG"
    }
  }
  tfsa {
    cash = 0.00
    stock-positions {
      1150 "ABC"
      207 "XYZ"
    }
  }
  nra {
    cash = 283.90
    stock-positions {
      340 "ABC"
      290 "XYZ"
    }
    stock-book-values {
      33362.34 "XYZ"
      14978.87 "ABC"
    }
  }
}</pre>
The initial positions of your investment accounts and bank account.
If your bank balance falls below the <em> small-balance-limit</em>, then you are charged fees.
The <em>stock-book-values</em> applies only to the <em>nra</em> account (the non-registered account).
The <em>convert-rsp-to-rif</em> date deserves special mention. 
Before this date, the RIF account simply has no minimum annual withdrawal. 
Other than that, it acts the same. 
That means no contributions to the RSP can be made before the conversion date in this simulation.


<P><pre>sequential-liquidation {
  avoid-downturn-years = 2 
  account-sequence = rif,nra,tfsa
  stock-sequence = "xeg,cm,enb"
  sell 6.0% on *-11-26 | 2027-01-01..2034-12-31 
  sell 3.0% on *-11-26 | 2035-01-01.. 
}</pre>
Describes how to liquidate stock positions, in order to generate cash flow.
The <em>avoid-downturn-years</em> is a way of avoiding liquidations when the price of the stocks are lower.
In the example above, the meaning is <em>if the current price is lower than the prices of the past 2 years, then don't sell</em>.
The two <em>-sequence</em> define the order in which to sell stock, from which account, and then which stock in that account.
The above example sells 6% of the investments on Nov 26, from 2027 to 2034. Later, from 2035 on, 3% is sold.


<P><pre>annual-tfsa-top-up {
  account-sequence = rif,nra
  stock-sequence = "enb,cm"
  on *-01-03                
}</pre>





<!-- 
<h2>Web Site Versus Stand-alone</h2>
When deploying this code under a web site:
<ul>
 <li>pro: the user doesn't need to install any software
 <li>pro: it's easier to run a scenario, at least when getting started
 <li>con: web sites come and go, and usually die with the person who created them
 <li>con: the user exposes their personal financial information to a third party, and that may not be secure
 <li>con: some scenarios take a while to execute, and waiting for a web site to respond can be frustrating
</ul>

Advantages of running this code locally on your computer:
<ul>
 <li>con: for non-programmers, learning how to run the code takes some effort (but it's not that hard, I swear!)
 <li>pro: scenarios that take a while to execute can provide feedback as they run 
 <li>pro: the user is not dependent on a web site
 <li>pro: the user can alter the code directly, if need be
 <li>pro: not limited by time or disk space
 <li>pro: it executes faster than a web site
</ul> 
 -->


</body>
</html>